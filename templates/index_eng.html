<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selection of a drug for obesity</title>
<link type="text/css" href="{{ url_for('static', filename='styles.css')}}" rel="stylesheet" />
</head>
<body>
<div id="welcome">
<h1>A model for predicting the response to obesity treatment</h1>
<p> This application allows you to predict the patient's response to treatment with an anti-obesity drug <em>"Sibutramine"</em>. <br> Enter the patient's indicators and click <b> Make a forecast </b> </p>
</div>
<div class="container">
<div class="form">
<form action="/" method="GET">
<div id = "buttons">
<p>Select the operating mode: </p>
<button style = {% if mode=='model_3month' %} "background-color: aqua; {% else%} "background-color: gray; {% endif%} width:100%;" type="submit" name="mode" value="model_3month" >First patient visit</button>
<button style = {% if mode=='model_6month' %} "background-color: aqua; {% else%} "background-color: gray; {% endif%} width:100%;" type="submit" name="mode" value="model_6month" > Visit in 3 months</button>
</div>
<br>
<a> Use additional parameters (hormones, RNA, etc.) </a>
<label class="custom-checkbox">
<input type="checkbox" name="extra" {{ checked }}>
<span class="checkmark"> </span>
</label>
<br>
</form>
<form action="/predict" method="POST">
{% for field in fields %}
<div id="paramform">
<label for="{{ field.name }}">{{ field.description }}</label>
<input type="text" name="{{ field.name }}" placeholder="{{ field.placeholder }}" value="{{ field.value }}">
</div>
{% endfor %}
<button type="submit">Make a forecast</button>
</form>
</div>

<div class="info">
{% if result==0 or result==1 %}
<div id="result">
<h3>Results:</h3>
<p><b> Drug: </b> Sibutramine </p>
<b> Predicted weight loss: </b>
<span class="decision-color" style="background-color: {%if result == 0%} #CD5C5C {% else %} #90EE90 {%endif%}">
{% if result==1%} more {% if mode=='model_3month'%} 5 {% else %} 7 {% endif%} % {% else %} less {% if mode=='model_3month'%} 5 {% else %} 7 {% endif%} % {% endif %}
</span>
<p><b> Confidence: </b>{{confidence }}% </p>
<div class="box">
<img src="{{ url_for('static', filename='explain.jpg') }}" alt="Partial Dependence Plot">
</div>
</div>
{% endif %}


<div id="partial dependency">
<h3>The influence of parameter values on the solution of models</h3>
<p>Select the parameters to see how they affect the final decisions of the model (via the Shapley number graph)</p>

<form action="/explain" method="post">
<div id="buttons">
<label for="feature1">Select the main parameter:</label>

<select name="feature1" id="feature1">
{% for feature in features %}
<option value="{{ feature }}">{{ feature }}</option>
{% endfor %}
</select>
<label for="feature2">Select an additional parameter:</label>
<select name="feature2" id="feature2">
<option hidden selected>-</option>
{% for feature in features %}
<option value="{{ feature }}">{{ feature }}</option>
{% endfor %}
</select>

<button type="submit">Generate a graph</button>
</div>
</form>

<div id="partial_box">
{% if image_path %}
<img src="{{ url_for('static', filename='partial_explain.jpg') }}" alt="Partial Dependence Plot">
{% else %}
<p style="font-size: 5;"> No parameters selected </p>
{% endif %}
</div>
</div>

<div id="overall_explanation">
<h3>SHAP model explanation graph for Sibutramine {% if mode=='model_3month' %} for the first visit {% else %} for the visit after 3 months of treatment {%endif %}</h3>
<div class="box">
<img src="{{ url_for('static', filename='overall_explain.jpg') }}" alt="Partial Dependence Plot">
</div>
</div>
</div>
</div>
</body>
</html>